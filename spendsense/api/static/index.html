<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpendSense Dashboard</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üéØ SpendSense Dashboard</h1>
            <p class="subtitle">Synthetic Data Generation & Testing Platform</p>
        </header>

        <!-- Navigation -->
        <nav class="tabs">
            <button class="tab active" data-tab="generate">Generate Profiles</button>
            <button class="tab" data-tab="profiles">View Profiles</button>
            <button class="tab" data-tab="signals">Behavioral Signals</button>
            <button class="tab" data-tab="assignment">Persona Assignment</button>
            <button class="tab" data-tab="recommendations">üí° Recommendations</button>
            <button class="tab" data-tab="metrics">üìä Evaluation Metrics</button>
            <button class="tab" data-tab="stats">Statistics</button>
            <button class="tab" data-tab="personas">Personas</button>
        </nav>

        <!-- Generate Tab -->
        <div id="generate" class="tab-content active">
            <div class="card">
                <h2>Generate Synthetic User Profiles</h2>
                <p>Create realistic user profiles with persona-based financial characteristics.</p>

                <form id="generate-form" class="form">
                    <div class="form-group">
                        <label for="num-users">Number of Users (50-120)</label>
                        <input type="number" id="num-users" min="50" max="120" value="120" required>
                    </div>

                    <div class="form-group">
                        <label for="seed">Random Seed</label>
                        <input type="number" id="seed" value="42" required>
                        <small>Use the same seed for reproducible results</small>
                    </div>

                    <button type="submit" class="btn btn-primary">Generate Profiles</button>
                </form>

                <div id="generate-result" class="result hidden"></div>
            </div>
        </div>

        <!-- Profiles Tab -->
        <div id="profiles" class="tab-content">
            <div class="card">
                <div class="card-header">
                    <h2>User Profiles</h2>
                    <div class="filters">
                        <select id="persona-filter" class="select">
                            <option value="">All Personas</option>
                            <option value="high_utilization">High Utilization</option>
                            <option value="variable_income">Variable Income</option>
                            <option value="subscription_heavy">Subscription Heavy</option>
                            <option value="savings_builder">Savings Builder</option>
                            <option value="control">Control</option>
                        </select>
                        <button id="refresh-profiles" class="btn btn-secondary">Refresh</button>
                    </div>
                </div>

                <div id="profiles-list" class="profiles-list">
                    <p class="text-muted">Generate profiles to see them here...</p>
                </div>

                <div id="profile-pagination" class="pagination hidden"></div>
            </div>
        </div>

        <!-- Behavioral Signals Tab -->
        <div id="signals" class="tab-content">
            <div class="card">
                <h2>üîç Behavioral Signals Detection</h2>
                <p>Analyze user financial behavior patterns across multiple dimensions</p>

                <form id="signals-form" class="form">
                    <div class="form-group">
                        <label for="signals-user-id">User ID</label>
                        <input type="text" id="signals-user-id" value="user_MASKED_000" required>
                    </div>

                    <div class="form-group">
                        <label for="signals-window">Time Window</label>
                        <select id="signals-window" class="select">
                            <option value="30">30 Days (Short-term)</option>
                            <option value="180" selected>180 Days (Long-term)</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">Analyze Signals</button>
                </form>

                <div id="signals-result" class="signals-dashboard hidden">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Persona Assignment Tab -->
        <div id="assignment" class="tab-content">
            <div class="card">
                <h2>üë§ Persona Assignment System</h2>
                <p>View persona assignments for users based on behavioral signals analysis</p>

                <form id="assignment-form" class="form">
                    <div class="form-group">
                        <label for="assignment-user-id">User ID</label>
                        <input type="text" id="assignment-user-id" value="user_MASKED_000" required>
                    </div>

                    <div class="form-group">
                        <label for="assignment-window">Time Window</label>
                        <select id="assignment-window" class="select">
                            <option value="">Both Windows</option>
                            <option value="30d">30 Days (Short-term)</option>
                            <option value="180d">180 Days (Long-term)</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">Get Assignment</button>
                </form>

                <div id="assignment-result" class="assignment-dashboard hidden">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats" class="tab-content">
            <div class="card">
                <h2>Profile Statistics</h2>
                <div id="stats-content">
                    <p class="text-muted">Generate profiles to see statistics...</p>
                </div>
            </div>
        </div>

        <!-- Personas Tab -->
        <div id="personas" class="tab-content">
            <div class="card">
                <h2>Persona Definitions</h2>
                <p>SpendSense uses 5 persona archetypes to generate realistic behavioral patterns:</p>
                <div id="personas-content" class="personas-grid"></div>
            </div>
        </div>

        <!-- Recommendations Tab (Epic 4) -->
        <div id="recommendations" class="tab-content">
            <div class="card">
                <h2>üí° Personalized Recommendations (Epic 4)</h2>
                <p>Generate personalized financial recommendations combining educational content and partner offers with transparent rationales.</p>

                <form id="recommendations-form" class="form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rec-user-id">User ID</label>
                            <input type="text" id="rec-user-id" value="user_MASKED_000" required>
                        </div>

                        <div class="form-group">
                            <label for="rec-window">Time Window</label>
                            <select id="rec-window" class="select">
                                <option value="30d" selected>30 Days</option>
                                <option value="180d">180 Days</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="rec-force-generate" checked>
                                Force Generate (ignore cache)
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Generate Recommendations</button>
                </form>

                <div id="recommendations-loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Generating recommendations...</p>
                </div>

                <div id="recommendations-result" class="result hidden">
                    <!-- Summary Card -->
                    <div class="rec-summary card-header">
                        <h3>Recommendation Summary</h3>
                        <div class="rec-meta">
                            <span class="badge" id="rec-persona"></span>
                            <span class="badge badge-secondary" id="rec-window-badge"></span>
                            <span class="badge badge-success" id="rec-time"></span>
                        </div>
                    </div>

                    <!-- Mandatory Disclaimer -->
                    <div class="disclaimer-box">
                        <strong>‚ö†Ô∏è Disclaimer:</strong>
                        <p id="rec-disclaimer"></p>
                    </div>

                    <!-- Signals Detected -->
                    <div class="signals-box">
                        <h4>üîç Signals Detected</h4>
                        <div id="rec-signals"></div>
                    </div>

                    <!-- Recommendations List -->
                    <div class="recommendations-list">
                        <h3>Your Personalized Recommendations</h3>
                        <div id="rec-items"></div>
                    </div>

                    <!-- Metadata -->
                    <div class="metadata-box">
                        <h4>üìä Generation Metadata</h4>
                        <pre id="rec-metadata"></pre>
                    </div>
                </div>

                <div id="recommendations-error" class="error hidden"></div>
            </div>
        </div>

        <!-- Evaluation Metrics Tab (Epic 7) -->
        <div id="metrics" class="tab-content">
            <div class="card">
                <div class="metrics-header">
                    <div>
                        <h2>üìä Evaluation Metrics Dashboard</h2>
                        <p>Real-time quality metrics across all 5 evaluation dimensions (Epic 7)</p>
                    </div>
                    <button id="metrics-refresh-btn" class="btn btn-secondary">‚Üª Refresh</button>
                </div>

                <div id="metrics-loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Loading evaluation metrics...</p>
                </div>

                <div id="metrics-content" class="metrics-dashboard hidden">
                    <!-- Overall Score Card -->
                    <div class="overall-score-card">
                        <div class="score-header">
                            <h3>Overall Quality Score</h3>
                            <span id="metrics-timestamp" class="timestamp">--</span>
                        </div>
                        <div class="score-display">
                            <div class="score-circle">
                                <div class="score-value" id="overall-score">--</div>
                                <div class="score-label">Score</div>
                            </div>
                            <div class="score-details">
                                <div class="score-detail">
                                    <span class="label">Grade:</span>
                                    <span class="value" id="overall-grade">--</span>
                                </div>
                                <div class="score-detail">
                                    <span class="label">Status:</span>
                                    <span class="badge" id="overall-status">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Metrics Grid -->
                    <div class="eval-metrics-grid">
                        <!-- Coverage Metrics -->
                        <div class="eval-metric-card">
                            <div class="metric-header">
                                <h3>üìã Coverage
                                    <span class="info-icon" data-tooltip="Coverage measures how many users receive persona assignments and have behavioral signals detected. High coverage indicates the system is analyzing most users effectively.">‚ìò</span>
                                </h3>
                                <span class="metric-badge" id="coverage-status">--</span>
                            </div>
                            <div class="metric-body">
                                <div class="metric-stat">
                                    <span class="stat-label">Persona Assignment
                                        <span class="info-icon" data-tooltip="Percentage of users who have been assigned a financial persona (e.g., Young Professional, Low Savings). Target: >95%">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="coverage-persona">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Signal Detection
                                        <span class="info-icon" data-tooltip="Percentage of users with sufficient behavioral signals (‚â•3 qualifying signals) for accurate persona classification. Target: >90%">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="coverage-signals">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Component Score
                                        <span class="info-icon" data-tooltip="Overall coverage score (0-100) combining persona assignment and signal detection rates.">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="coverage-score">--</span>
                                </div>
                            </div>
                            <canvas id="coverage-chart" class="metric-chart"></canvas>
                        </div>

                        <!-- Explainability Metrics -->
                        <div class="eval-metric-card">
                            <div class="metric-header">
                                <h3>üí¨ Explainability
                                    <span class="info-icon" data-tooltip="Explainability measures how well the system explains its recommendations to users. Higher scores indicate clearer, more actionable explanations.">‚ìò</span>
                                </h3>
                                <span class="metric-badge" id="explainability-status">--</span>
                            </div>
                            <div class="metric-body">
                                <div class="metric-stat">
                                    <span class="stat-label">Rationale Presence
                                        <span class="info-icon" data-tooltip="Percentage of recommendations that include a rationale explaining why the recommendation was made. Target: 100%">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="explainability-presence">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Quality Score
                                        <span class="info-icon" data-tooltip="Average quality of rationales on a 1-5 scale. Evaluates clarity, specificity, and actionability. Target: ‚â•3.5/5">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="explainability-quality">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Component Score
                                        <span class="info-icon" data-tooltip="Overall explainability score (0-100) based on rationale presence, quality, and completeness.">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="explainability-score">--</span>
                                </div>
                            </div>
                            <canvas id="explainability-chart" class="metric-chart"></canvas>
                        </div>

                        <!-- Performance Metrics -->
                        <div class="eval-metric-card">
                            <div class="metric-header">
                                <h3>‚ö° Performance
                                    <span class="info-icon" data-tooltip="Performance measures system speed and resource efficiency. Lower latency and higher throughput indicate better scalability.">‚ìò</span>
                                </h3>
                                <span class="metric-badge" id="performance-status">--</span>
                            </div>
                            <div class="metric-body">
                                <div class="metric-stat">
                                    <span class="stat-label">Avg Latency
                                        <span class="info-icon" data-tooltip="Average time to generate recommendations for one user. Includes signal detection, persona assignment, and recommendation matching. Target: <5 seconds">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="performance-latency">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Throughput
                                        <span class="info-icon" data-tooltip="Number of users the system can process per minute. Higher is better for scalability.">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="performance-throughput">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Component Score
                                        <span class="info-icon" data-tooltip="Overall performance score (0-100) based on latency, throughput, and bottleneck analysis.">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="performance-score">--</span>
                                </div>
                            </div>
                            <canvas id="performance-chart" class="metric-chart"></canvas>
                        </div>

                        <!-- Auditability Metrics -->
                        <div class="eval-metric-card">
                            <div class="metric-header">
                                <h3>üîí Auditability
                                    <span class="info-icon" data-tooltip="Auditability measures regulatory compliance and audit trail completeness. Critical for financial services regulations (GDPR, CCPA, FCRA).">‚ìò</span>
                                </h3>
                                <span class="metric-badge" id="auditability-status">--</span>
                            </div>
                            <div class="metric-body">
                                <div class="metric-stat">
                                    <span class="stat-label">Consent Compliance
                                        <span class="info-icon" data-tooltip="Percentage of recommendations only shown to users with valid consent. CRITICAL: Must be 100% for regulatory compliance.">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="auditability-consent">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Overall Compliance
                                        <span class="info-icon" data-tooltip="Combined compliance score across consent, eligibility, tone, disclaimers, and audit log completeness. Target: 100%">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="auditability-compliance">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Component Score
                                        <span class="info-icon" data-tooltip="Overall auditability score showing how well the system maintains compliance with regulations. Red flags require immediate attention.">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="auditability-score">--</span>
                                </div>
                            </div>
                            <canvas id="auditability-chart" class="metric-chart"></canvas>
                        </div>

                        <!-- Fairness Metrics -->
                        <div class="eval-metric-card">
                            <div class="metric-header">
                                <h3>‚öñÔ∏è Fairness
                                    <span class="info-icon" data-tooltip="Fairness measures whether recommendations are distributed equitably across demographic groups. Detects potential bias in persona assignment and recommendations.">‚ìò</span>
                                </h3>
                                <span class="metric-badge" id="fairness-status">--</span>
                            </div>
                            <div class="metric-body">
                                <div class="metric-stat">
                                    <span class="stat-label">Parity Ratio
                                        <span class="info-icon" data-tooltip="Ratio of recommendation rates between demographic groups. Values between 0.8-1.25 indicate fair distribution. N/A means insufficient demographic data.">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="fairness-parity">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Assessment
                                        <span class="info-icon" data-tooltip="Overall fairness assessment: PASS (no bias detected), CONCERN (potential bias), FAIL (significant bias), or N/A (insufficient data).">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="fairness-assessment">--</span>
                                </div>
                                <div class="metric-stat">
                                    <span class="stat-label">Component Score
                                        <span class="info-icon" data-tooltip="Overall fairness score (0-100). Based on demographic parity, equal opportunity, and statistical significance testing.">‚ìò</span>
                                    </span>
                                    <span class="stat-value" id="fairness-score">--</span>
                                </div>
                            </div>
                            <canvas id="fairness-chart" class="metric-chart"></canvas>
                        </div>

                        <!-- Component Scores Comparison -->
                        <div class="eval-metric-card full-width">
                            <div class="metric-header">
                                <h3>üìä Component Scores Comparison</h3>
                            </div>
                            <div class="metric-body">
                                <canvas id="components-chart" class="metric-chart-large"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="metrics-error" class="result error hidden"></div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>SpendSense v1.0 | Built with FastAPI & Vanilla JS</p>
        </footer>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
